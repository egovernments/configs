serviceMaps:
  serviceName: individual
  mappings:
    - version: 1.0
      description: Persists Individual
      fromTopic: save-individual-health-topic
      isTransaction: true
      isAuditEnabled: true
      module: INDIVIDUAL
      objecIdJsonPath: $.Individuals.*.id
      tenantIdJsonPath: $.Individuals.*.tenantId
      userUuidJsonPath: $.RequestInfo.userInfo.uuid
      transactionCodeJsonPath: $.Individuals.*.clientReferenceId
      auditAttributeBasePath: $.Individuals.*
      queryMaps:
        - query: INSERT INTO health.address(id, clientReferenceId, tenantId, doorNo, latitude, longitude, locationAccuracy, type, addressLine1, addressLine2, landmark, city, pincode, buildingName, street, localityCode, wardCode) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);
          basePath: $.Individuals.*.address.*
          jsonMaps:
            - jsonPath: $.Individuals.*.address.*.id
            - jsonPath: $.Individuals.*.address.*.clientReferenceId
            - jsonPath: $.Individuals.*.address.*.tenantId
            - jsonPath: $.Individuals.*.address.*.doorNo
            - jsonPath: $.Individuals.*.address.*.latitude
            - jsonPath: $.Individuals.*.address.*.longitude
            - jsonPath: $.Individuals.*.address.*.locationAccuracy
            - jsonPath: $.Individuals.*.address.*.type
            - jsonPath: $.Individuals.*.address.*.addressLine1
            - jsonPath: $.Individuals.*.address.*.addressLine2
            - jsonPath: $.Individuals.*.address.*.landmark
            - jsonPath: $.Individuals.*.address.*.city
            - jsonPath: $.Individuals.*.address.*.pincode
            - jsonPath: $.Individuals.*.address.*.buildingName
            - jsonPath: $.Individuals.*.address.*.street
            - jsonPath: $.Individuals.*.address.*.locality.code
            - jsonPath: $.Individuals.*.address.*.ward.code
        - query: INSERT INTO health.individual(id, userId, userUuid, clientReferenceId, tenantId, givenName, familyName, otherNames, dateOfBirth, gender, bloodGroup, mobileNumber, altContactNumber, email, fatherName, husbandName, photo, additionalDetails, createdBy, lastModifiedBy, createdTime, lastModifiedTime, rowVersion, isDeleted, individualId, relationship, isSystemUser, isSystemUserActive, username, password, type, roles, clientCreatedTime, clientLastModifiedTime, clientCreatedBy, clientLastModifiedBy) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);
          basePath: $.Individuals.*
          jsonMaps:
            - jsonPath: $.Individuals.*.id
            - jsonPath: $.Individuals.*.userId
            - jsonPath: $.Individuals.*.userUuid
            - jsonPath: $.Individuals.*.clientReferenceId
            - jsonPath: $.Individuals.*.tenantId
            - jsonPath: $.Individuals.*.name.givenName
            - jsonPath: $.Individuals.*.name.familyName
            - jsonPath: $.Individuals.*.name.otherNames
            - jsonPath: $.Individuals.*.dateOfBirth
              type: DATE
            - jsonPath: $.Individuals.*.gender
            - jsonPath: $.Individuals.*.bloodGroup
            - jsonPath: $.Individuals.*.mobileNumber
            - jsonPath: $.Individuals.*.altContactNumber
            - jsonPath: $.Individuals.*.email
            - jsonPath: $.Individuals.*.fatherName
            - jsonPath: $.Individuals.*.husbandName
            - jsonPath: $.Individuals.*.photo
            - jsonPath: $.Individuals.*.additionalFields
              type: JSON
              dbType: JSONB
            - jsonPath: $.Individuals.*.auditDetails.createdBy
            - jsonPath: $.Individuals.*.auditDetails.lastModifiedBy
            - jsonPath: $.Individuals.*.auditDetails.createdTime
            - jsonPath: $.Individuals.*.auditDetails.lastModifiedTime
            - jsonPath: $.Individuals.*.rowVersion
            - jsonPath: $.Individuals.*.isDeleted
            - jsonPath: $.Individuals.*.individualId
            - jsonPath: $.Individuals.*.relationship
            - jsonPath: $.Individuals.*.isSystemUser
            - jsonPath: $.Individuals.*.isSystemUserActive
            - jsonPath: $.Individuals.*.userDetails.username
            - jsonPath: $.Individuals.*.userDetails.password
            - jsonPath: $.Individuals.*.userDetails.type
            - jsonPath: $.Individuals.*.userDetails.roles
              type: JSON
              dbType: JSONB
            - jsonPath: $.Individuals.*.clientAuditDetails.createdTime
            - jsonPath: $.Individuals.*.clientAuditDetails.lastModifiedTime
            - jsonPath: $.Individuals.*.clientAuditDetails.createdBy
            - jsonPath: $.Individuals.*.clientAuditDetails.lastModifiedBy

        - query: INSERT INTO health.individual_address(individualId, addressId, type, createdBy, lastModifiedBy, createdTime, lastModifiedTime, isDeleted) VALUES (?, ?, ?, ?, ?, ?, ?, ?);
          basePath: $.Individuals.*.address.*
          jsonMaps:
            - jsonPath: $.Individuals.*.address.*.individualId
            - jsonPath: $.Individuals.*.address.*.id
            - jsonPath: $.Individuals.*.address.*.type
            - jsonPath: $.Individuals.*.address.*.auditDetails.createdBy
            - jsonPath: $.Individuals.*.address.*.auditDetails.lastModifiedBy
            - jsonPath: $.Individuals.*.address.*.auditDetails.createdTime
            - jsonPath: $.Individuals.*.address.*.auditDetails.lastModifiedTime
            - jsonPath: $.Individuals.*.address.*.isDeleted
        - query: INSERT INTO health.individual_identifier(id, clientReferenceId, identifierType, identifierId, individualId, createdBy, lastModifiedBy, createdTime, lastModifiedTime, isDeleted) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?);
          basePath: $.Individuals.*.identifiers.*
          jsonMaps:
            - jsonPath: $.Individuals.*.identifiers.*.id
            - jsonPath: $.Individuals.*.clientReferenceId
            - jsonPath: $.Individuals.*.identifiers.*.identifierType
            - jsonPath: $.Individuals.*.identifiers.*.identifierId
            - jsonPath: $.Individuals.*.identifiers.*.individualId
            - jsonPath: $.Individuals.*.identifiers.*.auditDetails.createdBy
            - jsonPath: $.Individuals.*.identifiers.*.auditDetails.lastModifiedBy
            - jsonPath: $.Individuals.*.identifiers.*.auditDetails.createdTime
            - jsonPath: $.Individuals.*.identifiers.*.auditDetails.lastModifiedTime
            - jsonPath: $.Individuals.*.identifiers.*.isDeleted
        - query: INSERT INTO health.individual_skill(id, clientReferenceId, individualId, type, level, experience, createdBy, lastModifiedBy, createdTime, lastModifiedTime, isDeleted) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);
          basePath: $.Individuals.*.skills.*
          jsonMaps:
            - jsonPath: $.Individuals.*.skills.*.id
            - jsonPath: $.Individuals.*.skills.*.clientReferenceId
            - jsonPath: $.Individuals.*.skills.*.individualId
            - jsonPath: $.Individuals.*.skills.*.type
            - jsonPath: $.Individuals.*.skills.*.level
            - jsonPath: $.Individuals.*.skills.*.experience
            - jsonPath: $.Individuals.*.skills.*.auditDetails.createdBy
            - jsonPath: $.Individuals.*.skills.*.auditDetails.lastModifiedBy
            - jsonPath: $.Individuals.*.skills.*.auditDetails.createdTime
            - jsonPath: $.Individuals.*.skills.*.auditDetails.lastModifiedTime
            - jsonPath: $.Individuals.*.skills.*.isDeleted

    - version: 1.0
      description: Updates Individual
      fromTopic: update-individual-health-topic
      isTransaction: true
      isAuditEnabled: true
      module: INDIVIDUAL
      objecIdJsonPath: $.Individuals.*.id
      tenantIdJsonPath: $.Individuals.*.tenantId
      userUuidJsonPath: $.RequestInfo.userInfo.uuid
      transactionCodeJsonPath: $.Individuals.*.clientReferenceId
      auditAttributeBasePath: $.Individuals.*
      queryMaps:
        - query: UPDATE health.individual SET userId=?, userUuid=?, tenantId=?, givenName=?, familyName=?, otherNames=?, dateOfBirth=?, Gender=?, bloodGroup=?, mobileNumber=?, altContactNumber=?, email=?, fatherName=?, husbandName=?, relationship=?, photo=?, isSystemUserActive=?, additionalDetails=?, lastModifiedBy=?, lastModifiedTime=?, rowVersion=?, username = ?, password = ?, type = ?, roles = ?, clientLastModifiedTime = ?, clientLastModifiedBy = ? WHERE id=? AND isDeleted=false;
          basePath: $.Individuals.*
          jsonMaps:
            - jsonPath: $.Individuals.*.userId
            - jsonPath: $.Individuals.*.userUuid
            - jsonPath: $.Individuals.*.tenantId
            - jsonPath: $.Individuals.*.name.givenName
            - jsonPath: $.Individuals.*.name.familyName
            - jsonPath: $.Individuals.*.name.otherNames
            - jsonPath: $.Individuals.*.dateOfBirth
              type: DATE
            - jsonPath: $.Individuals.*.gender
            - jsonPath: $.Individuals.*.bloodGroup
            - jsonPath: $.Individuals.*.mobileNumber
            - jsonPath: $.Individuals.*.altContactNumber
            - jsonPath: $.Individuals.*.email
            - jsonPath: $.Individuals.*.fatherName
            - jsonPath: $.Individuals.*.husbandName
            - jsonPath: $.Individuals.*.relationship
            - jsonPath: $.Individuals.*.photo
            - jsonPath: $.Individuals.*.isSystemUserActive
            - jsonPath: $.Individuals.*.additionalFields
              type: JSON
              dbType: JSONB
            - jsonPath: $.Individuals.*.auditDetails.lastModifiedBy
            - jsonPath: $.Individuals.*.auditDetails.lastModifiedTime
            - jsonPath: $.Individuals.*.rowVersion
            - jsonPath: $.Individuals.*.userDetails.username
            - jsonPath: $.Individuals.*.userDetails.password
            - jsonPath: $.Individuals.*.userDetails.type
            - jsonPath: $.Individuals.*.userDetails.roles
              type: JSON
              dbType: JSONB
            - jsonPath: $.Individuals.*.clientAuditDetails.lastModifiedTime
            - jsonPath: $.Individuals.*.clientAuditDetails.lastModifiedBy
            - jsonPath: $.Individuals.*.id
        - query: INSERT INTO health.address(id, clientReferenceId, tenantId, doorNo, latitude, longitude, locationAccuracy, type, addressLine1, addressLine2, landmark, city, pincode, buildingName, street, localityCode, wardCode) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ON CONFLICT (id) DO UPDATE SET doorno=?, latitude=?, longitude=?, locationaccuracy=?, type=?, addressline1=?, addressline2=?, landmark=?, city=?, pincode=?, buildingname=?, street=?, localitycode=?, wardCode=?;
          basePath: $.Individuals.*.address.*
          jsonMaps:
            - jsonPath: $.Individuals.*.address.*.id
            - jsonPath: $.Individuals.*.address.*.clientReferenceId
            - jsonPath: $.Individuals.*.address.*.tenantId
            - jsonPath: $.Individuals.*.address.*.doorNo
            - jsonPath: $.Individuals.*.address.*.latitude
            - jsonPath: $.Individuals.*.address.*.longitude
            - jsonPath: $.Individuals.*.address.*.locationAccuracy
            - jsonPath: $.Individuals.*.address.*.type
            - jsonPath: $.Individuals.*.address.*.addressLine1
            - jsonPath: $.Individuals.*.address.*.addressLine2
            - jsonPath: $.Individuals.*.address.*.landmark
            - jsonPath: $.Individuals.*.address.*.city
            - jsonPath: $.Individuals.*.address.*.pincode
            - jsonPath: $.Individuals.*.address.*.buildingName
            - jsonPath: $.Individuals.*.address.*.street
            - jsonPath: $.Individuals.*.address.*.locality.code
            - jsonPath: $.Individuals.*.address.*.ward.code
            - jsonPath: $.Individuals.*.address.*.doorNo
            - jsonPath: $.Individuals.*.address.*.latitude
            - jsonPath: $.Individuals.*.address.*.longitude
            - jsonPath: $.Individuals.*.address.*.locationAccuracy
            - jsonPath: $.Individuals.*.address.*.type
            - jsonPath: $.Individuals.*.address.*.addressLine1
            - jsonPath: $.Individuals.*.address.*.addressLine2
            - jsonPath: $.Individuals.*.address.*.landmark
            - jsonPath: $.Individuals.*.address.*.city
            - jsonPath: $.Individuals.*.address.*.pincode
            - jsonPath: $.Individuals.*.address.*.buildingName
            - jsonPath: $.Individuals.*.address.*.street
            - jsonPath: $.Individuals.*.address.*.locality.code
            - jsonPath: $.Individuals.*.address.*.ward.code
        - query: INSERT INTO health.individual_address(individualId, addressId, type, createdBy, lastModifiedBy, createdTime, lastModifiedTime, isDeleted) VALUES (?, ?, ?, ?, ?, ?, ?, ?) ON CONFLICT (individualId, addressId, type, isDeleted) WHERE isDeleted=false DO UPDATE SET lastModifiedBy = ?, lastModifiedTime = ?;
          basePath: $.Individuals.*.address.*
          jsonMaps:
            - jsonPath: $.Individuals.*.address.*.individualId
            - jsonPath: $.Individuals.*.address.*.id
            - jsonPath: $.Individuals.*.address.*.type
            - jsonPath: $.Individuals.*.address.*.auditDetails.createdBy
            - jsonPath: $.Individuals.*.address.*.auditDetails.lastModifiedBy
            - jsonPath: $.Individuals.*.address.*.auditDetails.createdTime
            - jsonPath: $.Individuals.*.address.*.auditDetails.lastModifiedTime
            - jsonPath: $.Individuals.*.address.*.isDeleted
            - jsonPath: $.Individuals.*.address.*.auditDetails.lastModifiedBy
            - jsonPath: $.Individuals.*.address.*.auditDetails.lastModifiedTime
        - query: INSERT INTO health.individual_identifier(id, clientReferenceId, individualId, identifierType, identifierId, createdBy, lastModifiedBy, createdTime, lastModifiedTime, isDeleted) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ON CONFLICT (id) WHERE isDeleted=false DO UPDATE SET identifierId = ?, identifierType = ?, lastModifiedBy = ?, lastModifiedTime = ?;
          basePath: $.Individuals.*.identifiers.*
          jsonMaps:
            - jsonPath: $.Individuals.*.identifiers.*.id
            - jsonPath: $.Individuals.*.identifiers.*.clientReferenceId
            - jsonPath: $.Individuals.*.identifiers.*.individualId
            - jsonPath: $.Individuals.*.identifiers.*.identifierType
            - jsonPath: $.Individuals.*.identifiers.*.identifierId
            - jsonPath: $.Individuals.*.identifiers.*.auditDetails.createdBy
            - jsonPath: $.Individuals.*.identifiers.*.auditDetails.lastModifiedBy
            - jsonPath: $.Individuals.*.identifiers.*.auditDetails.createdTime
            - jsonPath: $.Individuals.*.identifiers.*.auditDetails.lastModifiedTime
            - jsonPath: $.Individuals.*.identifiers.*.isDeleted
            - jsonPath: $.Individuals.*.identifiers.*.identifierId
            - jsonPath: $.Individuals.*.identifiers.*.identifierType
            - jsonPath: $.Individuals.*.identifiers.*.auditDetails.lastModifiedBy
            - jsonPath: $.Individuals.*.identifiers.*.auditDetails.lastModifiedTime
        - query: INSERT INTO health.individual_skill(id, clientReferenceId, individualId, type, level, experience, createdBy, lastModifiedBy, createdTime, lastModifiedTime, isDeleted) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ON CONFLICT (id) WHERE isDeleted=false DO UPDATE SET type = ?, level = ?, experience = ?, lastModifiedBy = ?, lastModifiedTime = ?;
          basePath: $.Individuals.*.skills.*
          jsonMaps:
            - jsonPath: $.Individuals.*.skills.*.id
            - jsonPath: $.Individuals.*.skills.*.clientReferenceId
            - jsonPath: $.Individuals.*.skills.*.individualId
            - jsonPath: $.Individuals.*.skills.*.type
            - jsonPath: $.Individuals.*.skills.*.level
            - jsonPath: $.Individuals.*.skills.*.experience
            - jsonPath: $.Individuals.*.skills.*.auditDetails.createdBy
            - jsonPath: $.Individuals.*.skills.*.auditDetails.lastModifiedBy
            - jsonPath: $.Individuals.*.skills.*.auditDetails.createdTime
            - jsonPath: $.Individuals.*.skills.*.auditDetails.lastModifiedTime
            - jsonPath: $.Individuals.*.skills.*.isDeleted
            - jsonPath: $.Individuals.*.skills.*.type
            - jsonPath: $.Individuals.*.skills.*.level
            - jsonPath: $.Individuals.*.skills.*.experience
            - jsonPath: $.Individuals.*.skills.*.auditDetails.lastModifiedBy
            - jsonPath: $.Individuals.*.skills.*.auditDetails.lastModifiedTime

    - version: 1.0
      description: Deletes Individual and related Entities
      fromTopic: delete-individual-health-topic
      isTransaction: true
      isAuditEnabled: true
      module: INDIVIDUAL
      objecIdJsonPath: $.Individuals.*.id
      tenantIdJsonPath: $.Individuals.*.tenantId
      userUuidJsonPath: $.RequestInfo.userInfo.uuid
      transactionCodeJsonPath: $.Individuals.*.clientReferenceId
      auditAttributeBasePath: $.Individuals.*
      queryMaps:
        - query: UPDATE health.individual SET lastModifiedBy=?, clientLastModifiedTime = ?, clientLastModifiedBy = ?,  lastModifiedTime=?, rowVersion=?, isDeleted=?, isSystemUserActive=? WHERE id=?;
          basePath: $.Individuals.*
          jsonMaps:
            - jsonPath: $.Individuals.*.auditDetails.lastModifiedBy
            - jsonPath: $.Individuals.*.clientAuditDetails.lastModifiedTime
            - jsonPath: $.Individuals.*.clientAuditDetails.lastModifiedBy
            - jsonPath: $.Individuals.*.auditDetails.lastModifiedTime
            - jsonPath: $.Individuals.*.rowVersion
            - jsonPath: $.Individuals.*.isDeleted
            - jsonPath: $.Individuals.*.isSystemUserActive
            - jsonPath: $.Individuals.*.id
        - query: UPDATE health.individual_address SET lastModifiedBy=?, lastModifiedTime=?, isDeleted=? WHERE individualId=? AND addressId=?;
          basePath: $.Individuals.*.address.*
          jsonMaps:
            - jsonPath: $.Individuals.*.address.*.auditDetails.lastModifiedBy
            - jsonPath: $.Individuals.*.address.*.auditDetails.lastModifiedTime
            - jsonPath: $.Individuals.*.address.*.isDeleted
            - jsonPath: $.Individuals.*.address.*.individualId
            - jsonPath: $.Individuals.*.address.*.id
        - query: UPDATE health.individual_identifier SET lastModifiedBy=?, lastModifiedTime=?, isDeleted=? WHERE id=?;
          basePath: $.Individuals.*.identifiers.*
          jsonMaps:
            - jsonPath: $.Individuals.*.identifiers.*.auditDetails.lastModifiedBy
            - jsonPath: $.Individuals.*.identifiers.*.auditDetails.lastModifiedTime
            - jsonPath: $.Individuals.*.identifiers.*.isDeleted
            - jsonPath: $.Individuals.*.identifiers.*.id
        - query: UPDATE health.individual_skill SET lastModifiedBy=?, lastModifiedTime=?, isDeleted=? WHERE id=?;
          basePath: $.Individuals.*.skills.*
          jsonMaps:
            - jsonPath: $.Individuals.*.skills.*.auditDetails.lastModifiedBy
            - jsonPath: $.Individuals.*.skills.*.auditDetails.lastModifiedTime
            - jsonPath: $.Individuals.*.skills.*.isDeleted
            - jsonPath: $.Individuals.*.skills.*.id

    - version: 1.0
      description: Updates userId and userUuid received from user-service into an individual
      fromTopic: update-user-id-health-topic
      isTransaction: true
      isAuditEnabled: true
      module: INDIVIDUAL
      objecIdJsonPath: $.Individuals.*.id
      tenantIdJsonPath: $.Individuals.*.tenantId
      userUuidJsonPath: $.RequestInfo.userInfo.uuid
      transactionCodeJsonPath: $.Individuals.*.clientReferenceId
      auditAttributeBasePath: $.Individuals.*
      queryMaps:
        - query: UPDATE health.individual SET userId=?, userUuid=? WHERE id=?;
          basePath: $.Individuals.*
          jsonMaps:
            - jsonPath: $.Individuals.*.userId
            - jsonPath: $.Individuals.*.userUuid
            - jsonPath: $.Individuals.*.id