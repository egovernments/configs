serviceMaps:
  serviceName: pqm-service
  mappings:
    - version: 1.0
      description: Persists PQM Test Data in eg_pqm_tests table
      fromTopic: save-test-application
      isTransaction: true
      queryMaps:
        - query: INSERT INTO eg_pqm_tests(testId, tenantId, plantCode, processCode, stageCode, materialCode, deviceCode, sourceType, status, wfStatus, scheduledDate, additionalDetails, isActive, createdBy, lastModifiedBy, createdTime, lastModifiedTime) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);
          basePath: $.tests.*
          jsonMaps:
            - jsonPath: $.tests.*.testId
            - jsonPath: $.tests.*.tenantId
            - jsonPath: $.tests.*.plantCode
            - jsonPath: $.tests.*.processCode
            - jsonPath: $.tests.*.stageCode
            - jsonPath: $.tests.*.materialCode
            - jsonPath: $.tests.*.deviceCode
            - jsonPath: $.tests.*.sourceType
            - jsonPath: $.tests.*.status
            - jsonPath: $.tests.*.wfStatus
            - jsonPath: $.tests.*.scheduledDate
            - jsonPath: $.tests.*.additionalDetails
              type: JSON
              dbType: JSONB
            - jsonPath: $.tests.*.isActive
            - jsonPath: $.tests.*.auditDetails.createdBy
            - jsonPath: $.tests.*.auditDetails.lastModifiedBy
            - jsonPath: $.tests.*.auditDetails.createdTime
            - jsonPath: $.tests.*.auditDetails.lastModifiedTime


        - query: INSERT INTO eg_pqm_test_result_documents (id, testId, documentUid, documentUri, documentType, filestoreId, isActive, additionalDetails, createdBy, lastModifiedBy, createdTime, lastModifiedTime) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);
          basePath: $.tests.*.documents.*
          jsonMaps:
            - jsonPath: $.tests.*.documents.*.id
            - jsonPath: $.tests.*.documents.*.testId
            - jsonPath: $.tests.*.documents.*.documentUid
            - jsonPath: $.tests.*.documents.*.documentUri
            - jsonPath: $.tests.*.documents.*.documentType
            - jsonPath: $.tests.*.documents.*.filestoreId
            - jsonPath: $.tests.*.documents.*.isActive
            - jsonPath: $.tests.*.documents.*.additionalDetails
              type: JSON
              dbType: JSONB
            - jsonPath: $.tests.*.documents.*.auditDetails.createdBy
            - jsonPath: $.tests.*.documents.*.auditDetails.lastModifiedBy
            - jsonPath: $.tests.*.documents.*.auditDetails.createdTime
            - jsonPath: $.tests.*.documents.*.auditDetails.lastModifiedTime

        - query: INSERT INTO eg_pqm_test_criteria_results (id, testId, criteriaCode, resultValue, resultStatus, isActive, createdBy, lastModifiedBy, createdTime, lastModifiedTime) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?);
          basePath: $.tests.*.testCriteria.*
          jsonMaps:
            - jsonPath: $.tests.*.testCriteria.*.id
            - jsonPath: $.tests.*.testCriteria.*.testId
            - jsonPath: $.tests.*.testCriteria.*.criteriaCode
            - jsonPath: $.tests.*.testCriteria.*.resultValue
            - jsonPath: $.tests.*.testCriteria.*.resultStatus
            - jsonPath: $.tests.*.testCriteria.*.isActive
            - jsonPath: $.tests.*.testCriteria.*.auditDetails.createdBy
            - jsonPath: $.tests.*.testCriteria.*.auditDetails.lastModifiedBy
            - jsonPath: $.tests.*.testCriteria.*.auditDetails.createdTime
            - jsonPath: $.tests.*.testCriteria.*.auditDetails.lastModifiedTime

        - query: INSERT INTO eg_pqm_tests_auditlog (testId, tenantId, plantCode, processCode, stageCode, materialCode, deviceCode, sourceType, status, wfStatus, scheduledDate, additionalDetails, isActive, createdBy, lastModifiedBy, createdTime, lastModifiedTime) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);
          basePath: $.tests.*
          jsonMaps:
            - jsonPath: $.tests.*.testId
            - jsonPath: $.tests.*.tenantId
            - jsonPath: $.tests.*.plantCode
            - jsonPath: $.tests.*.processCode
            - jsonPath: $.tests.*.stageCode
            - jsonPath: $.tests.*.materialCode
            - jsonPath: $.tests.*.deviceCode
            - jsonPath: $.tests.*.sourceType
            - jsonPath: $.tests.*.status
            - jsonPath: $.tests.*.wfStatus
            - jsonPath: $.tests.*.scheduledDate
            - jsonPath: $.tests.*.additionalDetails
              type: JSON
              dbType: JSONB
            - jsonPath: $.tests.*.isActive
            - jsonPath: $.tests.*.auditDetails.createdBy
            - jsonPath: $.tests.*.auditDetails.lastModifiedBy
            - jsonPath: $.tests.*.auditDetails.createdTime
            - jsonPath: $.tests.*.auditDetails.lastModifiedTime

        - query: INSERT INTO eg_pqm_test_result_documents_auditlog (id, testId, documentUid, documentUri, documentType, filestoreId, additionalDetails, isActive, createdBy, lastModifiedBy, createdTime, lastModifiedTime) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);
          basePath: $.tests.*.documents.*
          jsonMaps:
            - jsonPath: $.tests.*.documents.*.id
            - jsonPath: $.tests.*.documents.*.testId
            - jsonPath: $.tests.*.documents.*.documentUid
            - jsonPath: $.tests.*.documents.*.documentUri
            - jsonPath: $.tests.*.documents.*.documentType
            - jsonPath: $.tests.*.documents.*.filestoreId
            - jsonPath: $.tests.*.documents.*.additionalDetails
              type: JSON
              dbType: JSONB
            - jsonPath: $.tests.*.documents.*.isActive
            - jsonPath: $.tests.*.documents.*.auditDetails.createdBy
            - jsonPath: $.tests.*.documents.*.auditDetails.lastModifiedBy
            - jsonPath: $.tests.*.documents.*.auditDetails.createdTime
            - jsonPath: $.tests.*.documents.*.auditDetails.lastModifiedTime

        - query: INSERT INTO eg_pqm_test_criteria_results_auditlog (id, testId, criteriaCode, resultValue, resultStatus, isActive, createdBy, lastModifiedBy, createdTime, lastModifiedTime) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?);
          basePath: $.tests.*.testCriteria.*
          jsonMaps:
            - jsonPath: $.tests.*.testCriteria.*.id
            - jsonPath: $.tests.*.testCriteria.*.testId
            - jsonPath: $.tests.*.testCriteria.*.criteriaCode
            - jsonPath: $.tests.*.testCriteria.*.resultValue
            - jsonPath: $.tests.*.testCriteria.*.resultStatus
            - jsonPath: $.tests.*.testCriteria.*.isActive
            - jsonPath: $.tests.*.testCriteria.*.auditDetails.createdBy
            - jsonPath: $.tests.*.testCriteria.*.auditDetails.lastModifiedBy
            - jsonPath: $.tests.*.testCriteria.*.auditDetails.createdTime
            - jsonPath: $.tests.*.testCriteria.*.auditDetails.lastModifiedTime

    - version: 1.0
      description: Update PQM Application details in eg_pqm_tests table
      fromTopic: update-test-application
      isTransaction: true
      queryMaps:
        - query: INSERT INTO eg_pqm_tests_auditlog SELECT * FROM eg_pqm_tests WHERE testId = ?
          basePath: $.tests.*
          jsonMaps:
            - jsonPath: $.tests.*.testId

        - query: UPDATE eg_pqm_tests SET status = ?, wfStatus = ?, createdBy = ?, lastModifiedBy = ?, createdTime = ?, lastModifiedTime = ? WHERE testId = ?;
          basePath: $.tests.*
          jsonMaps:
            - jsonPath: $.tests.*.status
            - jsonPath: $.tests.*.wfStatus
            - jsonPath: $.tests.*.auditDetails.createdBy
            - jsonPath: $.tests.*.auditDetails.lastModifiedBy
            - jsonPath: $.tests.*.auditDetails.createdTime
            - jsonPath: $.tests.*.auditDetails.lastModifiedTime
            - jsonPath: $.tests.*.testId

        - query: INSERT INTO eg_pqm_test_result_documents (id, testId, documentUid, documentUri, documentType, filestoreId, isActive, additionalDetails, createdBy, lastModifiedBy, createdTime, lastModifiedTime) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);
          basePath: $.tests.*.documents.*
          jsonMaps:
            - jsonPath: $.tests.*.documents.*.id
            - jsonPath: $.tests.*.documents.*.testId
            - jsonPath: $.tests.*.documents.*.documentUid
            - jsonPath: $.tests.*.documents.*.documentUri
            - jsonPath: $.tests.*.documents.*.documentType
            - jsonPath: $.tests.*.documents.*.fileStoreId
            - jsonPath: $.tests.*.documents.*.isActive
            - jsonPath: $.tests.*.documents.*.additionalDetails
              type: JSON
              dbType: JSONB
            - jsonPath: $.tests.*.documents.*.auditDetails.createdBy
            - jsonPath: $.tests.*.documents.*.auditDetails.lastModifiedBy
            - jsonPath: $.tests.*.documents.*.auditDetails.createdTime
            - jsonPath: $.tests.*.documents.*.auditDetails.lastModifiedTime

        - query: INSERT INTO eg_pqm_test_result_documents_auditlog (id, testId, documentUid, documentUri, documentType, filestoreId, additionalDetails, isActive, createdBy, lastModifiedBy, createdTime, lastModifiedTime) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);
          basePath: $.tests.*.documents.*
          jsonMaps:
            - jsonPath: $.tests.*.documents.*.id
            - jsonPath: $.tests.*.documents.*.testId
            - jsonPath: $.tests.*.documents.*.documentUid
            - jsonPath: $.tests.*.documents.*.documentUri
            - jsonPath: $.tests.*.documents.*.documentType
            - jsonPath: $.tests.*.documents.*.fileStoreId
            - jsonPath: $.tests.*.documents.*.additionalDetails
              type: JSON
              dbType: JSONB
            - jsonPath: $.tests.*.documents.*.isActive
            - jsonPath: $.tests.*.documents.*.auditDetails.createdBy
            - jsonPath: $.tests.*.documents.*.auditDetails.lastModifiedBy
            - jsonPath: $.tests.*.documents.*.auditDetails.createdTime
            - jsonPath: $.tests.*.documents.*.auditDetails.lastModifiedTime

        - query: INSERT INTO eg_pqm_test_criteria_results_auditlog SELECT * FROM eg_pqm_test_criteria_results WHERE id = ?
          basePath: $.tests.*.testCriteria.*
          jsonMaps:
            - jsonPath: $.tests.*.testCriteria.*.id

        - query: UPDATE eg_pqm_test_criteria_results SET resultValue = ?, resultStatus = ?, isActive = ?, createdBy = ?, lastModifiedBy = ?, createdTime = ?, lastModifiedTime = ? WHERE id = ?;
          basePath: $.tests.*.testCriteria.*
          jsonMaps:
            - jsonPath: $.tests.*.testCriteria.*.resultValue
            - jsonPath: $.tests.*.testCriteria.*.resultStatus
            - jsonPath: $.tests.*.testCriteria.*.isActive
            - jsonPath: $.tests.*.testCriteria.*.auditDetails.createdBy
            - jsonPath: $.tests.*.testCriteria.*.auditDetails.lastModifiedBy
            - jsonPath: $.tests.*.testCriteria.*.auditDetails.createdTime
            - jsonPath: $.tests.*.testCriteria.*.auditDetails.lastModifiedTime
            - jsonPath: $.tests.*.testCriteria.*.id


    - version: 1.0
      description: Update PQM Application details in eg_pqm_tests table
      fromTopic: update-workflow-test-application
      isTransaction: true
      queryMaps:
        - query: INSERT INTO eg_pqm_tests_auditlog SELECT * FROM eg_pqm_tests WHERE testId = ?
          basePath: $.tests.*
          jsonMaps:
            - jsonPath: $.tests.*.testId

        - query: UPDATE eg_pqm_tests SET status = ?,wfStatus = ?, createdBy = ?, lastModifiedBy = ?, createdTime = ?, lastModifiedTime = ? WHERE testId = ?;
          basePath: $.tests.*
          jsonMaps:
            - jsonPath: $.tests.*.status
            - jsonPath: $.tests.*.wfStatus
            - jsonPath: $.tests.*.auditDetails.createdBy
            - jsonPath: $.tests.*.auditDetails.lastModifiedBy
            - jsonPath: $.tests.*.auditDetails.createdTime
            - jsonPath: $.tests.*.auditDetails.lastModifiedTime
            - jsonPath: $.tests.*.testId

        - query: INSERT INTO eg_pqm_test_criteria_results_auditlog SELECT * FROM eg_pqm_test_criteria_results WHERE id = ?
          basePath: $.tests.*.testCriteria.*
          jsonMaps:
            - jsonPath: $.tests.*.testCriteria.*.id

        - query: UPDATE eg_pqm_test_criteria_results SET resultValue = ?, resultStatus = ?, isActive = ?, createdBy = ?, lastModifiedBy = ?, createdTime = ?, lastModifiedTime = ?  WHERE id = ?;
          basePath: $.tests.*.testCriteria.*
          jsonMaps:
            - jsonPath: $.tests.*.testCriteria.*.resultValue
            - jsonPath: $.tests.*.testCriteria.*.resultStatus
            - jsonPath: $.tests.*.testCriteria.*.isActive
            - jsonPath: $.tests.*.testCriteria.*.auditDetails.createdBy
            - jsonPath: $.tests.*.testCriteria.*.auditDetails.lastModifiedBy
            - jsonPath: $.tests.*.testCriteria.*.auditDetails.createdTime
            - jsonPath: $.tests.*.testCriteria.*.auditDetails.lastModifiedTime
            - jsonPath: $.tests.*.testCriteria.*.id